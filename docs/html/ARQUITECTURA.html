<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARQUITECTURA</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .content {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 8px;
        }
        h3 {
            color: #7f8c8d;
        }
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e74c3c;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        pre code {
            background: transparent;
            color: #ecf0f1;
            padding: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        blockquote {
            border-left: 4px solid #3498db;
            margin: 20px 0;
            padding-left: 20px;
            color: #555;
            font-style: italic;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="content">
        <h1 id="arquitectura-tecnica-tidalai-companion">Arquitectura TÃ©cnica: TidalAI Companion</h1>
<h2 id="vision-general">VisiÃ³n General</h2>
<p>TidalAI Companion es un sistema distribuido que combina generaciÃ³n de mÃºsica con IA en una Raspberry Pi 3B+ y ejecuciÃ³n de audio en un PC con TidalCycles, comunicÃ¡ndose en tiempo real vÃ­a OSC.</p>
<hr />
<h2 id="diagrama-de-arquitectura">Diagrama de Arquitectura</h2>
<pre class="codehilite"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PC PRINCIPAL                             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Navegador      â”‚                  â”‚   TidalCycles    â”‚    â”‚
â”‚  â”‚   Web            â”‚                  â”‚   (Haskell)      â”‚    â”‚
â”‚  â”‚                  â”‚                  â”‚                  â”‚    â”‚
â”‚  â”‚  - Interfaz UI   â”‚                  â”‚  - Live coding   â”‚    â”‚
â”‚  â”‚  - Controles     â”‚                  â”‚  - EvaluaciÃ³n    â”‚    â”‚
â”‚  â”‚  - VisualizaciÃ³n â”‚                  â”‚    de patrones   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                                      â”‚              â”‚
â”‚           â”‚ HTTP                                 â”‚ OSC          â”‚
â”‚           â”‚ (192.168.x.x:5000)                  â”‚ (interno)    â”‚
â”‚           â”‚                                      â”‚              â”‚
â”‚           â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚           â”‚                              â”‚  SuperCollider  â”‚    â”‚
â”‚           â”‚                              â”‚                 â”‚    â”‚
â”‚           â”‚                              â”‚  - OSC Server   â”‚    â”‚
â”‚           â”‚                              â”‚  - Synth Engine â”‚    â”‚
â”‚           â”‚                              â”‚  - Audio Output â”‚    â”‚
â”‚           â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                                      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                      â”‚
            â”‚          Red Local (WiFi/Ethernet)   â”‚
            â”‚                                      â”‚
            â”‚                                      â”‚ OSC
            â”‚                                      â”‚ (UDP 6010)
            â”‚                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â”‚                                      â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Flask Web      â”‚                  â”‚   OSC Client     â”‚    â”‚
â”‚  â”‚   Server         â”‚                  â”‚                  â”‚    â”‚
â”‚  â”‚                  â”‚                  â”‚  - EnvÃ­o msgs    â”‚    â”‚
â”‚  â”‚  - API REST      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  - GestiÃ³n       â”‚    â”‚
â”‚  â”‚  - WebSockets    â”‚                  â”‚    conexiÃ³n      â”‚    â”‚
â”‚  â”‚  - Static files  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â–²              â”‚
â”‚           â”‚                                     â”‚              â”‚
â”‚           â”‚                                     â”‚              â”‚
â”‚           â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚           â”‚                          â”‚  Pattern Generator â”‚    â”‚
â”‚           â”‚                          â”‚                    â”‚    â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  - GeneraciÃ³n      â”‚    â”‚
â”‚                                      â”‚  - ValidaciÃ³n      â”‚    â”‚
â”‚                                      â”‚  - Formateo        â”‚    â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                 â”‚              â”‚
â”‚                                                 â”‚              â”‚
â”‚                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                      â”‚   AI Model         â”‚    â”‚
â”‚                                      â”‚                    â”‚    â”‚
â”‚                                      â”‚  - Markov Chains   â”‚    â”‚
â”‚                                      â”‚  - RNN/LSTM (opt)  â”‚    â”‚
â”‚                                      â”‚  - TF Lite (opt)   â”‚    â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚                      RASPBERRY PI 3B+                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

<hr />
<h2 id="componentes-del-sistema">Componentes del Sistema</h2>
<h3 id="1-raspberry-pi-backend">1. Raspberry Pi - Backend</h3>
<h4 id="11-pattern-generator-pattern_generatorpy">1.1 Pattern Generator (<code>pattern_generator.py</code>)</h4>
<p><strong>Responsabilidades</strong>:
- Generar patrones TidalCycles sintÃ¡cticamente vÃ¡lidos
- Aplicar parÃ¡metros de densidad, complejidad, tempo
- Validar sintaxis antes de enviar
- Mantener estado de generaciÃ³n</p>
<p><strong>Interfaz</strong>:</p>
<pre class="codehilite"><code class="language-python">class PatternGenerator:
    def __init__(self, model=None):
        &quot;&quot;&quot;Inicializar con modelo opcional (Markov/RNN)&quot;&quot;&quot;

    def generate(self, 
                 pattern_type: str,      # 'drums', 'bass', 'melody'
                 density: float,          # 0.0 - 1.0
                 complexity: float,       # 0.0 - 1.0
                 tempo: int) -&gt; str:      # BPM
        &quot;&quot;&quot;Generar patrÃ³n con parÃ¡metros&quot;&quot;&quot;

    def validate(self, pattern: str) -&gt; bool:
        &quot;&quot;&quot;Validar sintaxis Tidal&quot;&quot;&quot;
</code></pre>

<p><strong>Modos de generaciÃ³n</strong>:
1. <strong>Hardcoded</strong>: Biblioteca de patrones predefinidos (MVP1)
2. <strong>Markov</strong>: GeneraciÃ³n probabilÃ­stica (MVP3)
3. <strong>Neural</strong>: RNN/LSTM (futuro)</p>
<hr />
<h4 id="12-osc-client-osc_clientpy">1.2 OSC Client (<code>osc_client.py</code>)</h4>
<p><strong>Responsabilidades</strong>:
- Enviar mensajes OSC al PC
- Gestionar conexiÃ³n y reconexiÃ³n
- Buffering de mensajes si es necesario
- Logging de comunicaciÃ³n</p>
<p><strong>Interfaz</strong>:</p>
<pre class="codehilite"><code class="language-python">class OSCClient:
    def __init__(self, target_ip: str, target_port: int):
        &quot;&quot;&quot;Configurar cliente OSC&quot;&quot;&quot;

    def send_pattern(self, 
                     channel: str,    # 'd1', 'd2', etc.
                     pattern: str):   # CÃ³digo Tidal
        &quot;&quot;&quot;Enviar patrÃ³n completo&quot;&quot;&quot;

    def send_param(self,
                   channel: str,
                   param: str,       # 'speed', 'cutoff', etc.
                   value: float):
        &quot;&quot;&quot;Enviar parÃ¡metro individual&quot;&quot;&quot;

    def stop_channel(self, channel: str):
        &quot;&quot;&quot;Detener canal especÃ­fico&quot;&quot;&quot;
</code></pre>

<p><strong>Protocolo OSC</strong>:</p>
<pre class="codehilite"><code>/tidal/pattern &lt;channel:string&gt; &lt;pattern:string&gt;
/tidal/param &lt;channel:string&gt; &lt;param:string&gt; &lt;value:float&gt;
/tidal/stop &lt;channel:string&gt;
</code></pre>

<hr />
<h4 id="13-flask-web-server-apppy">1.3 Flask Web Server (<code>app.py</code>)</h4>
<p><strong>Responsabilidades</strong>:
- Servir interfaz web
- Exponer API REST para control
- Gestionar estado de la aplicaciÃ³n
- Coordinar generador y cliente OSC</p>
<p><strong>Endpoints</strong>:</p>
<pre class="codehilite"><code class="language-python">GET  /                      # Interfaz web
POST /api/generate          # Generar patrÃ³n
POST /api/send              # Enviar a Tidal
POST /api/config            # Actualizar config
GET  /api/status            # Estado actual
POST /api/mode              # Cambiar modo
</code></pre>

<p><strong>Request/Response Examples</strong>:</p>
<pre class="codehilite"><code class="language-json">POST /api/generate
{
  &quot;type&quot;: &quot;drums&quot;,
  &quot;density&quot;: 0.7,
  &quot;complexity&quot;: 0.5,
  &quot;tempo&quot;: 140
}

Response:
{
  &quot;pattern&quot;: &quot;d1 $ sound \&quot;bd*4 sn*2 hh*8\&quot;&quot;,
  &quot;timestamp&quot;: 1706169195
}
</code></pre>

<hr />
<h4 id="14-ai-model-markov_modelpy">1.4 AI Model (<code>markov_model.py</code>)</h4>
<p><strong>Responsabilidades</strong>:
- Entrenar con corpus de patrones
- Generar nuevos patrones probabilÃ­sticamente
- Ajustar creatividad vs coherencia</p>
<p><strong>Interfaz</strong>:</p>
<pre class="codehilite"><code class="language-python">class MarkovModel:
    def train(self, corpus: List[str]):
        &quot;&quot;&quot;Entrenar con patrones de ejemplo&quot;&quot;&quot;

    def generate(self, 
                 seed: str = None,
                 length: int = 20,
                 temperature: float = 1.0) -&gt; str:
        &quot;&quot;&quot;Generar patrÃ³n nuevo&quot;&quot;&quot;

    def save(self, path: str):
        &quot;&quot;&quot;Guardar modelo entrenado&quot;&quot;&quot;

    def load(self, path: str):
        &quot;&quot;&quot;Cargar modelo&quot;&quot;&quot;
</code></pre>

<p><strong>Algoritmo</strong>:
1. Tokenizar patrones Tidal (palabras clave, samples, operadores)
2. Construir cadenas de Markov de orden 2-3
3. Generar secuencias respetando sintaxis
4. Validar y corregir si es necesario</p>
<hr />
<h3 id="2-pc-audio-engine">2. PC - Audio Engine</h3>
<h4 id="21-supercollider-osc-receiver-osc_receiverscd">2.1 SuperCollider OSC Receiver (<code>osc_receiver.scd</code>)</h4>
<p><strong>Responsabilidades</strong>:
- Escuchar mensajes OSC en puerto 6010
- Parsear y ejecutar patrones Tidal
- Logging de actividad
- Manejo de errores</p>
<p><strong>ImplementaciÃ³n</strong>:</p>
<pre class="codehilite"><code class="language-supercollider">(
// Configurar receptor OSC
OSCdef(\tidalPattern, { |msg, time, addr, recvPort|
    var channel = msg[1].asString;
    var pattern = msg[2].asString;

    // Log
    (&quot;Received pattern for &quot; ++ channel ++ &quot;: &quot; ++ pattern).postln;

    // Ejecutar en Tidal
    // (requiere integraciÃ³n con TidalCycles)

}, '/tidal/pattern');

OSCdef(\tidalParam, { |msg|
    var channel = msg[1].asString;
    var param = msg[2].asString;
    var value = msg[3].asFloat;

    (&quot;Setting &quot; ++ param ++ &quot; = &quot; ++ value ++ &quot; on &quot; ++ channel).postln;

}, '/tidal/param');

&quot;OSC Receiver ready on port 6010&quot;.postln;
)
</code></pre>

<p><strong>IntegraciÃ³n con TidalCycles</strong>:
- SuperCollider puede ejecutar cÃ³digo Haskell vÃ­a <code>unixCmd</code> (limitado)
- Alternativa: usar <code>ghci</code> como REPL y enviar comandos
- Mejor opciÃ³n: TidalCycles ya tiene soporte OSC, configurar para escuchar</p>
<hr />
<h4 id="22-tidalcycles-configuration">2.2 TidalCycles Configuration</h4>
<p><strong>Archivo</strong>: <code>BootTidal.hs</code> (modificado)</p>
<p>Configurar TidalCycles para aceptar patrones vÃ­a OSC:</p>
<pre class="codehilite"><code class="language-haskell">-- AÃ±adir receptor OSC personalizado
import Sound.OSC.FD

-- FunciÃ³n para evaluar patrones recibidos
evalRemotePattern :: String -&gt; String -&gt; IO ()
evalRemotePattern channel pattern = do
    putStrLn $ &quot;Evaluating: &quot; ++ channel ++ &quot; $ &quot; ++ pattern
    -- Evaluar en el contexto de Tidal
    -- (requiere acceso al intÃ©rprete GHCi)
</code></pre>

<p><strong>Nota</strong>: Esta es la parte mÃ¡s compleja de la integraciÃ³n. Alternativas:
1. Usar <code>tidal-listener</code> (si existe)
2. Crear bridge en Haskell que escuche OSC
3. Usar archivos temporales que Tidal carga automÃ¡ticamente</p>
<hr />
<h3 id="3-interfaz-web">3. Interfaz Web</h3>
<h4 id="31-frontend-indexhtml-appjs">3.1 Frontend (<code>index.html</code> + <code>app.js</code>)</h4>
<p><strong>Componentes UI</strong>:</p>
<pre class="codehilite"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         TidalAI Companion                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Modo de OperaciÃ³n                   â”‚   â”‚
â”‚  â”‚  â—‹ Sugerencias  â—‹ AutÃ³nomo  â—‹ HÃ­bridoâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ParÃ¡metros                          â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚  Densidad:     [â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘] 60%   â”‚   â”‚
â”‚  â”‚  Complejidad:  [â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘] 40%   â”‚   â”‚
â”‚  â”‚  Tempo:        140 BPM              â”‚   â”‚
â”‚  â”‚  Temperatura:  [â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘] 0.5    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Estilo Musical                      â”‚   â”‚
â”‚  â”‚  [Techno â–¼]                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Instrumentos                        â”‚   â”‚
â”‚  â”‚  â˜‘ Kick  â˜‘ Snare  â˜‘ Hi-hat         â”‚   â”‚
â”‚  â”‚  â˜ Bass  â˜ Synth  â˜ FX             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  [Generar PatrÃ³n]  [Enviar a Tidal]       â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PatrÃ³n Generado                     â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚  d1 $ sound &quot;bd*4 sn*2 hh*8&quot;       â”‚   â”‚
â”‚  â”‚    # speed 1.2                      â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Log de Actividad                    â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚  [07:33] PatrÃ³n generado            â”‚   â”‚
â”‚  â”‚  [07:33] Enviado a d1               â”‚   â”‚
â”‚  â”‚  [07:34] Modo cambiado a AutÃ³nomo   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

<p><strong>TecnologÃ­as</strong>:
- HTML5 + CSS3 (Flexbox/Grid)
- Vanilla JavaScript (sin frameworks pesados)
- Fetch API para comunicaciÃ³n con Flask
- CSS Variables para theming</p>
<hr />
<h2 id="flujo-de-datos">Flujo de Datos</h2>
<h3 id="escenario-1-modo-sugerencias">Escenario 1: Modo Sugerencias</h3>
<pre class="codehilite"><code>1. Usuario ajusta parÃ¡metros en interfaz web
   â†“
2. Click &quot;Generar PatrÃ³n&quot;
   â†“
3. Frontend â†’ POST /api/generate â†’ Flask
   â†“
4. Flask â†’ PatternGenerator.generate()
   â†“
5. PatternGenerator â†’ AI Model (si estÃ¡ activo)
   â†“
6. PatrÃ³n generado â†’ Flask â†’ Frontend
   â†“
7. Usuario revisa patrÃ³n en interfaz
   â†“
8. Usuario click &quot;Enviar a Tidal&quot;
   â†“
9. Frontend â†’ POST /api/send â†’ Flask
   â†“
10. Flask â†’ OSCClient.send_pattern()
    â†“
11. OSC Message â†’ SuperCollider (PC)
    â†“
12. SuperCollider â†’ TidalCycles
    â†“
13. ğŸµ Audio output
</code></pre>

<hr />
<h3 id="escenario-2-modo-autonomo">Escenario 2: Modo AutÃ³nomo</h3>
<pre class="codehilite"><code>1. Usuario activa modo AutÃ³nomo
   â†“
2. Frontend â†’ POST /api/mode {&quot;mode&quot;: &quot;autonomous&quot;}
   â†“
3. Flask inicia loop de generaciÃ³n automÃ¡tica
   â†“
4. Cada N compases:
   â”œâ”€ PatternGenerator.generate()
   â”œâ”€ OSCClient.send_pattern()
   â””â”€ Log â†’ Frontend (WebSocket opcional)
   â†“
5. Usuario ajusta parÃ¡metros en tiempo real
   â†“
6. PrÃ³xima generaciÃ³n usa nuevos parÃ¡metros
   â†“
7. ğŸµ Audio continuo con evoluciÃ³n
</code></pre>

<hr />
<h2 id="consideraciones-de-rendimiento">Consideraciones de Rendimiento</h2>
<h3 id="latencia">Latencia</h3>
<p><strong>Objetivo</strong>: &lt; 50ms de latencia total</p>
<p><strong>Breakdown</strong>:
- GeneraciÃ³n de patrÃ³n: &lt; 10ms (Markov) / &lt; 30ms (RNN)
- EnvÃ­o OSC: &lt; 5ms (red local)
- Procesamiento SuperCollider: &lt; 10ms
- Buffer de audio: ~10ms</p>
<p><strong>Optimizaciones</strong>:
- Pre-generar patrones en background
- Usar UDP para OSC (no TCP)
- Minimizar validaciÃ³n en tiempo real
- Cache de patrones frecuentes</p>
<hr />
<h3 id="memoria-raspberry-pi">Memoria (Raspberry Pi)</h3>
<p><strong>Disponible</strong>: ~700MB (de 1GB total, ~300MB para OS)</p>
<p><strong>Uso estimado</strong>:
- Python runtime: ~50MB
- Flask: ~30MB
- Modelo Markov: ~10-20MB
- Modelo RNN pequeÃ±o: ~50-100MB
- Buffers y cache: ~50MB</p>
<p><strong>Total</strong>: ~200-250MB â†’ âœ… Viable</p>
<hr />
<h3 id="cpu-raspberry-pi">CPU (Raspberry Pi)</h3>
<p><strong>Specs</strong>: 4x ARM Cortex-A53 @ 1.4GHz</p>
<p><strong>Carga estimada</strong>:
- Flask (idle): ~5% CPU
- GeneraciÃ³n Markov: ~10-20% CPU (burst)
- GeneraciÃ³n RNN: ~30-50% CPU (burst)
- OSC client: ~1% CPU</p>
<p><strong>Estrategia</strong>: GeneraciÃ³n asÃ­ncrona para no bloquear servidor web</p>
<hr />
<h2 id="seguridad-y-configuracion">Seguridad y ConfiguraciÃ³n</h2>
<h3 id="red-local">Red Local</h3>
<p><strong>ConfiguraciÃ³n recomendada</strong>:
- IP estÃ¡tica para Raspberry Pi
- Firewall: permitir puertos 5000 (Flask) y 6010 (OSC)
- Opcional: VPN si se quiere acceso remoto</p>
<p><strong>Archivo de configuraciÃ³n</strong> (<code>config.json</code>):</p>
<pre class="codehilite"><code class="language-json">{
  &quot;raspberry_pi&quot;: {
    &quot;ip&quot;: &quot;192.168.1.100&quot;,
    &quot;flask_port&quot;: 5000
  },
  &quot;pc&quot;: {
    &quot;ip&quot;: &quot;192.168.1.50&quot;,
    &quot;osc_port&quot;: 6010
  },
  &quot;generator&quot;: {
    &quot;default_tempo&quot;: 140,
    &quot;default_density&quot;: 0.6,
    &quot;default_complexity&quot;: 0.5
  }
}
</code></pre>

<hr />
<h2 id="extensibilidad">Extensibilidad</h2>
<h3 id="plugins-de-modelos">Plugins de Modelos</h3>
<p>Arquitectura permite mÃºltiples modelos:</p>
<pre class="codehilite"><code class="language-python">class ModelInterface:
    def generate(self, **params) -&gt; str:
        raise NotImplementedError

class MarkovModel(ModelInterface):
    # ImplementaciÃ³n Markov

class RNNModel(ModelInterface):
    # ImplementaciÃ³n RNN

class HybridModel(ModelInterface):
    # Combina mÃºltiples modelos
</code></pre>

<hr />
<h3 id="api-para-control-externo">API para Control Externo</h3>
<p>Otros programas pueden controlar TidalAI:</p>
<pre class="codehilite"><code class="language-bash"># Generar patrÃ³n desde lÃ­nea de comandos
curl -X POST http://192.168.1.100:5000/api/generate \
  -H &quot;Content-Type: application/json&quot; \
  -d '{&quot;type&quot;:&quot;drums&quot;,&quot;density&quot;:0.8}'

# Cambiar modo
curl -X POST http://192.168.1.100:5000/api/mode \
  -d '{&quot;mode&quot;:&quot;autonomous&quot;}'
</code></pre>

<p>Esto permite integraciÃ³n con:
- MIDI controllers (vÃ­a script Python)
- Otros live coding tools
- Sistemas de automatizaciÃ³n de shows</p>
<hr />
<h2 id="diagrama-de-secuencia-generacion-y-ejecucion">Diagrama de Secuencia: GeneraciÃ³n y EjecuciÃ³n</h2>
<pre class="codehilite"><code>Usuario    Frontend    Flask    Generator    OSC    SuperCollider    Tidal
  â”‚           â”‚          â”‚          â”‚         â”‚           â”‚           â”‚
  â”‚  Click    â”‚          â”‚          â”‚         â”‚           â”‚           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚          â”‚         â”‚           â”‚           â”‚
  â”‚           â”‚  POST    â”‚          â”‚         â”‚           â”‚           â”‚
  â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚         â”‚           â”‚           â”‚
  â”‚           â”‚          â”‚ generate()         â”‚           â”‚           â”‚
  â”‚           â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚         â”‚           â”‚           â”‚
  â”‚           â”‚          â”‚          â”‚ AI      â”‚           â”‚           â”‚
  â”‚           â”‚          â”‚          â”œâ”€â”€â”€â”€â”    â”‚           â”‚           â”‚
  â”‚           â”‚          â”‚          â”‚â—„â”€â”€â”€â”˜    â”‚           â”‚           â”‚
  â”‚           â”‚          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚           â”‚           â”‚
  â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚         â”‚           â”‚           â”‚
  â”‚  Display  â”‚          â”‚          â”‚         â”‚           â”‚           â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚          â”‚         â”‚           â”‚           â”‚
  â”‚           â”‚          â”‚          â”‚         â”‚           â”‚           â”‚
  â”‚  Click    â”‚          â”‚          â”‚         â”‚           â”‚           â”‚
  â”‚  &quot;Send&quot;   â”‚          â”‚          â”‚         â”‚           â”‚           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚          â”‚         â”‚           â”‚           â”‚
  â”‚           â”‚  POST    â”‚          â”‚         â”‚           â”‚           â”‚
  â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚         â”‚           â”‚           â”‚
  â”‚           â”‚          â”‚ send_pattern()     â”‚           â”‚           â”‚
  â”‚           â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚           â”‚
  â”‚           â”‚          â”‚          â”‚         â”‚  OSC msg  â”‚           â”‚
  â”‚           â”‚          â”‚          â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚
  â”‚           â”‚          â”‚          â”‚         â”‚           â”‚  eval()   â”‚
  â”‚           â”‚          â”‚          â”‚         â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚           â”‚          â”‚          â”‚         â”‚           â”‚           â”‚
  â”‚           â”‚          â”‚          â”‚         â”‚           â”‚  ğŸµ Audio â”‚
  â”‚           â”‚          â”‚          â”‚         â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚           â”‚          â”‚          â”‚         â”‚           â”‚           â”‚
</code></pre>

<hr />
<h2 id="conclusion">ConclusiÃ³n</h2>
<p>Esta arquitectura proporciona:
- âœ… SeparaciÃ³n clara de responsabilidades
- âœ… Escalabilidad (aÃ±adir mÃ¡s modelos, mÃ¡s RPis)
- âœ… Baja latencia para uso en vivo
- âœ… Flexibilidad (mÃºltiples modos de operaciÃ³n)
- âœ… Extensibilidad (API abierta, plugins)</p>
<p>El diseÃ±o modular permite desarrollo incremental y testing independiente de cada componente.</p>
    </div>
</body>
</html>
